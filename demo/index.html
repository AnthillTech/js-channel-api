<!DOCTYPE html>
<html>
    <head>
        <title>Event server client API sandbox</title>
        <link rel="stylesheet" media="screen" href="assets/main.css">
        <script src="assets/jquery-1.9.0.min.js" type="text/javascript"></script>
        <script src="../src/client-api.js" type="text/javascript"></script>
    </head>
    <body>
        
    <table width="100%">
        <tr>
            <td class="deviceColumn">
			    <h1>Client A</h1>
			    <div id="chatLog1" class="chatLog"></div>
                <div><button id="sendEventBtn1">Send event</button></div>
                <div><button id="sendMsgBtn1">Send message</button></div>
			    <div>Image event:
			     <img id="image1" src="data:image/jpeg;base64,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" /> 
			     <button id="sendImageBtn1">Send image</button>
			    </div>
            </td>
            <td class="deviceColumn">
                <h1>Client B</h1>
                <div id="chatLog2" class="chatLog"></div>
            </td>
        </tr>
        <tr>
            <td class="deviceColumn">
                <h1>Client C</h1>
                <div id="chatLog3" class="chatLog"></div>
                <button id="getPropertyBtn3">Get property from device D</button>
            </td>
            <td class="deviceColumn">
                <h1>Client D</h1>
                <div id="chatLog4" class="chatLog"></div>
            </td>
        </tr>
    </table>
 
    <script>
    
    $(document).ready(function() {

        //var url = "ws://vps77209.ovh.net:9000/ws";
        var url = "ws://localhost:9000/ws";
        var channelName = "test";
    	// Client A
        var connection1 = createConnection("deviceA", "pass", $('#chatLog1')); 

        $("#sendEventBtn1").click(function(event) {
            connection1.sendEvent("serviceA.event3", "12");
        });

        $("#sendMsgBtn1").click(function(event) {
            connection1.sendMessage("deviceB", "serviceD.command2", "12");
        });

        $("#sendImageBtn1").click(function(event) {
            var image1 = document.getElementById('image1');
            var params = {data:image1.src};            
            connection1.sendMessage("deviceB", "com.followit24.service.image.Image", JSON.stringify(params));
        });

        $("#textMsg1").keypress(function(event) {
            if (event.keyCode == '13') {
              var text = $("#textMsg1").val();
              connection1.sendToDevice("deviceB", "msg1", text);
              $("#textMsg1").val("");
            }
          });
        
        // Client B
        var connection2 = createConnection("deviceB", "pass", $('#chatLog2'));
        
        // Client C
        var connection3 = createConnection("deviceC", "pass", $('#chatLog3'));

        $("#getPropertyBtn3").click(function(event) {
            connection3.getDeviceProperty("deviceD", "level");
        });
        
        // Client D
        var connection4 = createConnection("deviceD", "pass", $('#chatLog4'));


        // Commons
        function createConnection(device, pass, chatLog){
            var connection = channelConnect(url, channelName, device, pass);
          
            connection.onConnected = function(){
              message("Connected");
            }

            connection.onError = function(reason){
              message("Error: " + reason);
            }
          
            connection.onDeviceJoinedChannel = function(deviceName){
           		message("Device " + deviceName + " joined channel.");
            }
            
            connection.onDeviceLeftChannel = function(deviceName){
                message("Device " + deviceName + " left channel.");
            }
            
            connection.onEvent = function(eventId, params){
                message("Received event <b>" + eventId + "</b> with params: <b>" + params + "</b>");
            }
            
            connection.onMessage = function(device, msgId, params){
            	if(msgId == "com.followit24.service.image.Image"){
            	    messageImage(JSON.parse(params).data)            		
            	} else {
            	    message("Received message <b>" + msgId + "</b> from <b>" + device + "</b> with params: <b>" + params + "</b>");
            	}
            }
            
            function message(msg){
              chatLog.append("<p class='event'>" + msg + "</p>");
            }

            function messageImage(data){
            	chatLog.append("<img src='" + data + "'/>");
            }

            return connection;
          }
          
    });
    
    
    
    </script>   

    </body>
</html>
